version: '3'
services:

  glados_postgres:
    image: postgres:latest
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${GLADOS_POSTGRES_PASSWORD?Glados Postgres Password Required}
      POSTGRES_DB: glados
    volumes:
      - ${GLADOS_POSTGRES_DATA_DIR?Glados Postgres Data Directory Required}:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - glados-net

  trin:
    hostname: trin
    image: portalnetwork/trin:latest
    command: "--web3-transport http --web3-http-address http://0.0.0.0:8545/"
    ports:
      - "8545:8545"
    networks: 
      - glados-net

  glados_audit:
    command: "--database-url postgres://postgres:${GLADOS_POSTGRES_PASSWORD}@glados_postgres:5432/glados --portal-client http://trin:8545"
    image: glados-audit:latest
    depends_on:
      - glados_postgres
      - trin
    networks:
      - glados-net      

  glados_monitor:
    command: "--migrate --database-url postgres://postgres:${GLADOS_POSTGRES_PASSWORD}@glados_postgres:5432/glados follow-head --provider-url https://mainnet.infura.io/v3/${INFURA_PROJECT_ID?Infura Project ID Required}"
    image: glados-monitor:latest
    depends_on:
      - glados_postgres
    networks:
      - glados-net

  glados_web:
    command: "--database-url postgres://postgres:password@glados_postgres:5432/glados"
    image: glados-web:latest
    depends_on:
      - glados_postgres
      - glados_monitor
      - glados_audit
    ports:
      - "3001:3001"
    networks:
      - glados-net

  glados_cartographer:
    command: "--database-url postgres://postgres:${GLADOS_POSTGRES_PASSWORD}@glados_postgres:5432/glados --transport http --http-url http://trin:8545 --concurrency 10"
    image: glados-cartographer:latest
    depends_on:
      - glados_postgres
      - trin
    networks:
      - glados-net

networks:
  glados-net:
    driver: bridge
